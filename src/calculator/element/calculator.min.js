class Calculator{constructor(){this.reset()}reset(){this._accumulator=null,this._operator="",this._history=""}addBinaryOperation(t,e){var a;if(null===this._accumulator)this._accumulator=e,a=`${e} ${t}`;else{let i=this._accumulator;switch(this._operator){case"+":i+=e;break;case"-":i-=e;break;case"*":i*=e;break;case"/":i/=e;break;case"=":break;default:throw new Error("Unknown binary operator")}this._accumulator=i,a=` ${e} ${t}`}"="===t?this._history="":this._history+=a,this._operator=t}get value(){return this._accumulator}get history(){return this._history}static applyUnaryOperation(t,e){switch(t){case"neg":return 0===e?0:-e;case"%":return e/100;case"recip":return 1/e;case"sqr":return Math.sqrt(e);default:throw new Error("Unknown unary operator")}}}class CalculatorEntry{constructor(){this._text="",this._isNew=!1}addDigit(t){this._isNew?(this._text=t,this._isNew=!1):"."===t&&this._text.includes(".")||(this._text+=t)}deleteDigit(){this._text=this._text.slice(0,-1)}startNew(){this._isNew=!0}empty(){this._text=""}get text(){return this._text}get hasValue(){return this._text.length>0&&"."!==this._text}get value(){return parseFloat(this._text)}set value(t){this._text=t.toString()}get displayText(){let t;if(0!==this._text.length){const e=this._text.split("."),a=parseFloat(e[0]);t=isNaN(a)?"":a.toLocaleString("en"),e.length>1&&(t+="."+e[1])}else t="0";return t}}class CalculatorMemory{constructor(){this._value=0}get value(){return this._value}update(t,e){if("c"===t)this._value=0;else if(!isNaN(e))switch(t){case"s":this._value=e;break;case"+":this._value+=e;break;case"-":this._value-=e;break;default:throw new Error("Unkown memeory action")}}}export class RedCalculatorElement extends HTMLElement{constructor(){super();const t=document.getElementById("red-calculator-template");if(null===t)throw new Error("<RedCalculatorElement> no template with id red-calculator-template found.");const e=this.attachShadow({mode:"open"});e.appendChild(t.content.cloneNode(!0)),this._entry=new CalculatorEntry,this._calculator=new Calculator,this._memory=new CalculatorMemory,this._result=e.querySelector(".result"),this._history=e.querySelector(".history"),this._calculatorResetRequired=!1,this._clickEventHandler=this._routeClickEvent.bind(this),this._uodateUi()}connectedCallback(){this.shadowRoot.querySelector(".calculator").addEventListener("click",this._clickEventHandler)}disconnectedCallback(){this.shadowRoot.querySelector(".calculator").removeEventListener("click",this._clickEventHandler)}_routeClickEvent(t){const e=t.target.classList;e.contains("digit")?this._digitClick(t):e.contains("binaryop")?this._binaryOperatorClick(t):e.contains("unaryop")?this._unaryOperatorClick(t):e.contains("cancel-entry")?this._cancelEntryClick(t):e.contains("cancel")?this._cancelClick(t):e.contains("mem")?this._memoryClick(t):e.contains("del")?this._deleteClick(t):e.contains("life")&&this._lifeClick(t)}_digitClick(t){this._maybeResetCalculator(),this._entry.addDigit(t.target.getAttribute("data-digit")),this._uodateUi()}_unaryOperatorClick(t){if(this._entry.hasValue){let e=t.target.getAttribute("data-op");this._maybeResetCalculator(),this._entry.value=Calculator.applyUnaryOperation(e,this._entry.value),this._uodateUi()}}_cancelEntryClick(){this._entry.empty(),this._uodateUi()}_lifeClick(){this._maybeResetCalculator(),this._entry.value=42,this._uodateUi()}_cancelClick(){this._entry.empty(),this._calculator.reset(),this._uodateUi()}_binaryOperatorClick(t){if(this._entry.hasValue){let e=t.target.getAttribute("data-op");this._calculator.addBinaryOperation(e,this._entry.value),this._entry.value=this._calculator.value,this._entry.startNew(),this._calculatorResetRequired="="===e,this._uodateUi()}}_memoryClick(t){let e=t.target.getAttribute("data-action");"r"===e?(this._entry.value=this._memory.value,this._uodateUi()):this._memory.update(e,this._entry.value)}_deleteClick(){this._entry.deleteDigit(),this._uodateUi()}_uodateUi(){this._result.innerHTML=this._entry.displayText,this._history.innerHTML=this._calculator.history}_maybeResetCalculator(){this._calculatorResetRequired&&(this._calculator.reset(),this._calculatorResetRequired=!1)}}window.customElements.define("red-calculator",RedCalculatorElement);